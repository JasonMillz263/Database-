

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Manage Quizzes | Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    /* Basic styles */
    body { font-family: 'Poppins', sans-serif; background-color: #f9fbff; }
    .container { max-width: 1200px; margin: auto; padding: 20px; }
    h2 { margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
    table th, table td { padding: 12px; text-align: center; border: 1px solid #ddd; }
    .btn { padding: 12px 18px; background: linear-gradient(135deg, #2563eb, #6d28d9); color: white; border: none; border-radius: 8px; cursor: pointer; }
    .btn:hover { opacity: 0.9; }
    .status { font-weight: bold; color: green; }
    .locked { color: red; }
  </style>
</head>

<body>

<div class="container">
  <h2>Manage Quizzes</h2>

  <!-- Form to Add a New Quiz -->
  <h3>Add New Quiz</h3>
  <form id="quizForm">
    <label for="courseSelect">Select Course/Module:</label>
    <select id="courseSelect" required>
      <!-- Dynamically populated from Firestore -->
    </select><br><br>

    <label for="question">Quiz Question:</label><br>
    <input type="text" id="question" required placeholder="Enter quiz question" /><br><br>

    <label for="correctAnswer">Correct Answer:</label><br>
    <input type="text" id="correctAnswer" required placeholder="Enter correct answer" /><br><br>

    <label for="wrongAnswers">Wrong Answers (comma-separated):</label><br>
    <input type="text" id="wrongAnswers" required placeholder="Enter wrong answers separated by commas" /><br><br>

    <label for="quizStatus">Status:</label><br>
    <select id="quizStatus" required>
      <option value="active">Active</option>
      <option value="inactive">Inactive</option>
    </select><br><br>

    <button class="btn" type="submit">Add Quiz</button>
  </form>

  <!-- Table to Display Existing Quizzes -->
  <h3>Existing Quizzes</h3>
  <table id="quizzesTable">
    <thead>
      <tr>
        <th>Course/Module</th>
        <th>Question</th>
        <th>Correct Answer</th>
        <th>Status</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      <!-- Quiz data will be populated here -->
    </tbody>
  </table>
</div>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<script>
// Firebase Configuration
const firebaseConfig = {
  apiKey: "AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain: "students-login-29409.firebaseapp.com",
  projectId: "students-login-29409"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Function to Load Available Courses from Firestore
async function loadCourses() {
  const coursesRef = db.collection('courses');
  const snapshot = await coursesRef.get();
  const courseSelect = document.getElementById('courseSelect');
  
  snapshot.forEach(doc => {
    const option = document.createElement('option');
    option.value = doc.id; // Course ID
    option.textContent = doc.data().course_name; // Course Name
    courseSelect.appendChild(option);
  });
}

// Function to Load Existing Quizzes
async function loadQuizzes() {
  const quizzesRef = db.collection('quizzes');
  const snapshot = await quizzesRef.get();

  const quizzesTable = document.getElementById('quizzesTable').getElementsByTagName('tbody')[0];
  quizzesTable.innerHTML = ''; // Clear previous entries

  snapshot.forEach(doc => {
    const quiz = doc.data();
    const row = document.createElement('tr');
    row.innerHTML = `
      <td>${quiz.course_name}</td>
      <td>${quiz.question}</td>
      <td>${quiz.correct_answer}</td>
      <td class="${quiz.status === 'active' ? 'status' : 'locked'}">${quiz.status}</td>
      <td>
        <button class="btn" onclick="editQuiz('${doc.id}')">Edit</button>
        <button class="btn" onclick="deleteQuiz('${doc.id}')">Delete</button>
      </td>
    `;
    quizzesTable.appendChild(row);
  });
}

// Function to Add a New Quiz
document.getElementById('quizForm').addEventListener('submit', async (e) => {
  e.preventDefault();

  const courseId = document.getElementById('courseSelect').value;
  const question = document.getElementById('question').value;
  const correctAnswer = document.getElementById('correctAnswer').value;
  const wrongAnswers = document.getElementById('wrongAnswers').value.split(',').map(answer => answer.trim());
  const status = document.getElementById('quizStatus').value;

  const courseRef = db.collection('courses').doc(courseId);
  const courseDoc = await courseRef.get();
  
  if (!courseDoc.exists) {
    alert('Course not found!');
    return;
  }

  const courseName = courseDoc.data().course_name;

  try {
    await db.collection('quizzes').add({
      course_id: courseId,
      course_name: courseName,
      question,
      correct_answer: correctAnswer,
      wrong_answers: wrongAnswers,
      status,
      created_at: firebase.firestore.FieldValue.serverTimestamp()
    });

    alert('Quiz added successfully!');
    loadQuizzes(); // Reload quizzes table
    document.getElementById('quizForm').reset(); // Reset form fields
  } catch (error) {
    console.error('Error adding quiz:', error);
    alert('Error adding quiz!');
  }
});

// Function to Edit a Quiz (future enhancement)
function editQuiz(quizId) {
  console.log('Edit quiz: ', quizId);
  // Fetch quiz details and prefill form to allow the admin to edit it
}

// Function to Delete a Quiz
async function deleteQuiz(quizId) {
  if (confirm('Are you sure you want to delete this quiz?')) {
    try {
      await db.collection('quizzes').doc(quizId).delete();
      alert('Quiz deleted!');
      loadQuizzes(); // Reload quizzes table
    } catch (error) {
      console.error('Error deleting quiz:', error);
      alert('Error deleting quiz!');
    }
  }
}

// Load courses and quizzes on page load
loadCourses();
loadQuizzes();
</script>

</body>
</html>
