<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Student Dashboard | Food Business Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

<style>
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{margin:0;background:#f3f6ff}
.header{background:linear-gradient(135deg,#0074D9,#8A2BE2);color:#fff;padding:22px;text-align:center}
.container{max-width:1100px;margin:-40px auto 30px;padding:0 15px}

.card{
background:#fff;
border-radius:18px;
padding:25px;
box-shadow:0 15px 30px rgba(0,0,0,.1);
margin-bottom:25px
}

.student-name-card{
text-align:center;
background:linear-gradient(135deg,#0074D9,#8A2BE2);
color:#fff;
font-size:20px;
font-weight:600;
padding:15px;
margin-bottom:25px;
border-radius:16px
}

.progress-bar{
height:14px;
background:#e6e9f5;
border-radius:20px;
overflow:hidden
}
.progress-fill{
height:100%;
width:0%;
background:linear-gradient(135deg,#0074D9,#8A2BE2)
}

.courses,.modules{
display:grid;
grid-template-columns:repeat(auto-fit,minmax(250px,1fr));
gap:16px
}

.course,.module{
border:1px solid #e0e4ff;
border-radius:16px;
padding:18px;
transition:.3s;
position:relative
}

.course button,.main{
margin-top:10px;
padding:10px 16px;
border:none;
border-radius:12px;
background:linear-gradient(135deg,#0074D9,#8A2BE2);
color:#fff;
font-weight:600;
cursor:pointer
}

.module.completed{
background:linear-gradient(135deg,#0074D9,#8A2BE2);
color:#fff
}
.module.locked{
background:#f4f4f4;
color:#aaa;
cursor:not-allowed
}
.module.completed::after{
content:"âœ” Completed";
position:absolute;
top:10px;
right:12px;
font-size:11px
}

.badge{
display:inline-block;
padding:4px 10px;
border-radius:20px;
font-size:11px;
background:#eee;
margin-left:6px
}

video{
width:100%;
border-radius:12px;
margin:15px 0
}

@media(max-width:600px){
.container{margin-top:-20px}
}
</style>
</head>

<body>

<div class="header">
<h2>Food Business Academy</h2>
<p>Student Dashboard</p>
</div>

<div class="container">

<div class="student-name-card" id="displayName">Student</div>

<!-- COURSE CATALOGUE -->
<div class="card">
<h3>Course Catalogue</h3>

<select id="categoryFilter" onchange="renderCourses()">
<option value="all">All Categories</option>
<option value="Dairy">Dairy</option>
<option value="Dried Fruits">Dried Fruits</option>
<option value="Marketing">Marketing</option>
</select>

<div class="courses" id="courseList"></div>
</div>

<!-- COURSE PREVIEW -->
<div class="card" id="coursePreview" style="display:none"></div>

<!-- PROGRESS -->
<div class="card">
<h3>Course Progress</h3>
<div class="progress-bar">
<div class="progress-fill" id="progressFill"></div>
</div>
<p><span id="progress">0</span>% completed</p>
</div>

<!-- MODULES -->
<div class="card">
<h3>Modules <span class="badge">Drip Content</span></h3>
<div class="modules" id="modules"></div>
</div>

<!-- QUIZ -->
<div class="card" id="quizCard" style="display:none">
<h3>Graded Assessment</h3>
<div id="quizArea"></div>
<button class="main" onclick="submitQuiz()">Submit Assessment</button>
<p id="quizResult"></p>
</div>

<button class="main" id="certBtn" style="display:none" onclick="downloadCertificate()">Download Certificate</button>
<button class="main" onclick="logout()">Logout</button>

</div>

<!-- SCRIPTS -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ================= FIREBASE ================= */
firebase.initializeApp({
apiKey:"AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
authDomain:"students-login-29409.firebaseapp.com",
projectId:"students-login-29409"
});
const auth=firebase.auth();
const db=firebase.firestore();

/* ================= COURSES ================= */
const courses=[
{
name:"Food Business Basics",
category:"Dairy",
price:"$49",
video:"https://www.w3schools.com/html/mov_bbb.mp4",
outcomes:["Start a food business","Understand food safety","Plan operations"],
modules:["Introduction","Business Planning","Food Safety","Operations"],
quiz:[
{q:"Why is food safety important?",options:["Protects consumers","Not important"],correct:0}
]
},
{
name:"Dried Fruits Processing & Export",
category:"Dried Fruits",
price:"$69",
video:"https://www.w3schools.com/html/movie.mp4",
outcomes:["Dry fruits correctly","Package for export","Meet standards"],
modules:["Drying Methods","Packaging","Export Standards"],
quiz:[
{q:"Why dry fruits?",options:["Preservation","Decoration"],correct:0}
]
},
{
name:"Food Marketing Mastery",
category:"Marketing",
price:"$59",
video:"https://www.w3schools.com/html/mov_bbb.mp4",
outcomes:["Build a brand","Increase sales","Use digital marketing"],
modules:["Branding","Sales","Digital Marketing"],
quiz:[
{q:"Marketing aims to?",options:["Increase sales","Confuse buyers"],correct:0}
]
}
];

let currentCourse=null;
let completedModules=[];

/* ================= AUTH ================= */
auth.onAuthStateChanged(async user=>{
if(!user){location.href='index.html';return}
const ref=db.collection('students').doc(user.uid);
let snap=await ref.get();
if(!snap.exists){
await ref.set({username:user.email.split('@')[0],completedModules:[],progress:0});
snap=await ref.get();
}
const data=snap.data();
displayName.innerText=data.username;
completedModules=data.completedModules||[];
currentCourse=data.course||null;
renderCourses();
if(currentCourse){
renderModules(currentCourse.modules);
renderQuiz();
updateProgress();
}
});

/* ================= UI ================= */
function renderCourses(){
const cat=categoryFilter.value;
courseList.innerHTML='';
courses.filter(c=>cat==='all'||c.category===cat).forEach(c=>{
courseList.innerHTML+=`
<div class="course">
<h4>${c.name}</h4>
<p>${c.category}</p>
<p><strong>${c.price}</strong></p>
<button onclick="previewCourse('${c.name}')">Preview</button>
</div>`;
});
}

function previewCourse(name){
const c=courses.find(x=>x.name===name);
coursePreview.style.display='block';
coursePreview.innerHTML=`
<h3>${c.name}</h3>
<video controls src="${c.video}"></video>
<p><strong>Curriculum:</strong> ${c.modules.join(', ')}</p>
<p><strong>Outcomes:</strong> ${c.outcomes.join(', ')}</p>
<p><strong>Price:</strong> ${c.price}</p>
<button class="main" onclick="enroll('${c.name}')">Enroll Now</button>`;
}

/* ================= ENROLL ================= */
async function enroll(name){
currentCourse=courses.find(c=>c.name===name);
completedModules=[];
await db.collection('students').doc(auth.currentUser.uid).update({
course:currentCourse,
completedModules:[],
progress:0,
quiz:null
});
renderModules(currentCourse.modules);
renderQuiz();
updateProgress();
}

/* ================= MODULES ================= */
function renderModules(mods){
modules.innerHTML='';
mods.forEach((x,i)=>{
const d=document.createElement('div');
d.className='module';
d.innerText=x;
if(completedModules.includes(x)) d.classList.add('completed');
else if(i>0 && !completedModules.includes(mods[i-1])) d.classList.add('locked');
d.onclick=async()=>{
if(d.classList.contains('locked')||d.classList.contains('completed'))return;
completedModules.push(x);
await db.collection('students').doc(auth.currentUser.uid).update({completedModules});
renderModules(mods);
updateProgress();
};
modules.appendChild(d);
});
}

/* ================= QUIZ ================= */
function renderQuiz(){
quizArea.innerHTML='';
currentCourse.quiz.forEach((q,i)=>{
quizArea.innerHTML+=`
<p>${i+1}. ${q.q}</p>
${q.options.map((o,idx)=>`
<label><input type="radio" name="q${i}" value="${idx}"> ${o}</label><br>`).join('')}
`;
});
quizCard.style.display='block';
}

async function submitQuiz(){
let score=0;
currentCourse.quiz.forEach((q,i)=>{
const a=document.querySelector(`input[name=q${i}]:checked`);
if(a && +a.value===q.correct)score++;
});
const percent=Math.round((score/currentCourse.quiz.length)*100);
await db.collection('students').doc(auth.currentUser.uid).update({quiz:{passed:percent>=50}});
quizResult.innerText=percent>=50?`Passed (${percent}%)`:`Failed (${percent}%)`;
updateProgress();
}

/* ================= PROGRESS & CERT ================= */
async function updateProgress(){
const p=Math.round((completedModules.length/currentCourse.modules.length)*100);
progress.innerText=p;
progressFill.style.width=p+'%';
await db.collection('students').doc(auth.currentUser.uid).update({progress:p});
const snap=await db.collection('students').doc(auth.currentUser.uid).get();
certBtn.style.display=(p===100 && snap.data().quiz?.passed)?'block':'none';
}

function downloadCertificate(){
const {jsPDF}=window.jspdf;
const doc=new jsPDF();
doc.text("Certificate of Completion",105,40,null,null,"center");
doc.text(displayName.innerText,105,60,null,null,"center");
doc.text(currentCourse.name,105,80,null,null,"center");
doc.save("certificate.pdf");
}

function logout(){auth.signOut().then(()=>location.href='index.html')}
</script>
</body>
</html>
