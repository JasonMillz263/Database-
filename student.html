<!-- FULL STUDENT DASHBOARD ‚Äì RESTORED & ENHANCED VERSION --><!-- Includes: Available Courses + Modules + Prices + Pay to Start + Quiz + Auto Certificate --><!DOCTYPE html><html lang="en">
<head>
<meta charset="UTF-8">
<title>Food Business Academy | Student Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0"><!-- Fonts & Icons --><link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"><style>
:root{
 --purple:#6d28d9;
 --blue:#2563eb;
 --bg:linear-gradient(180deg,#eef2ff,#f9fbff);
}
*{box-sizing:border-box;font-family:'Poppins',sans-serif}
body{margin:0;background:var(--bg);color:#1f2937}

/* LAYOUT */
.layout{display:grid;grid-template-columns:260px 1fr;min-height:100vh}

/* SIDEBAR */
.sidebar{
 background:linear-gradient(180deg,var(--blue),var(--purple));
 color:#fff;padding:25px
}
.sidebar h2{margin-bottom:30px}
.sidebar a{
 display:flex;gap:12px;align-items:center;
 color:#e5e7eb;text-decoration:none;
 padding:12px;border-radius:12px;margin-bottom:6px
}
.sidebar a:hover{background:rgba(255,255,255,.15)}
.logout{background:#ef4444;color:#fff}

/* HEADER */
.top-header{
 display:flex;justify-content:space-between;align-items:center;
 background:linear-gradient(135deg,var(--blue),var(--purple));
 color:#fff;padding:18px 25px;border-radius:18px;margin-bottom:25px
}
.badge{background:rgba(255,255,255,.2);padding:6px 14px;border-radius:999px}

/* MAIN */
.main{padding:30px}
.card{
 background:rgba(255,255,255,.85);
 border-radius:22px;padding:25px;
 box-shadow:0 20px 40px rgba(0,0,0,.08);
 margin-bottom:25px
}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:20px}

/* PROGRESS */
.progress{height:12px;background:#e5e7eb;border-radius:20px;overflow:hidden}
.progress span{display:block;height:100%;background:linear-gradient(135deg,var(--blue),var(--purple))}

/* MODULES */
.module{padding:10px;border-radius:10px;border:1px solid #e5e7eb;margin-bottom:8px}
.module.completed{background:#e0f2fe;border-color:var(--blue)}

/* BUTTON */
button{
 padding:12px 18px;border:none;border-radius:14px;
 background:linear-gradient(135deg,var(--blue),var(--purple));
 color:#fff;font-weight:600;cursor:pointer
}
button:hover{box-shadow:0 15px 35px rgba(109,40,217,.35)}

.hidden{display:none}
@media(max-width:900px){.layout{grid-template-columns:1fr}.sidebar{display:none}}
</style></head><body>
<div class="layout"><!-- SIDEBAR --><div class="sidebar">
 <h2><i class="fa-solid fa-graduation-cap"></i> FBA Portal</h2>
 <a href="#" onclick="show('dashboard')"><i class="fa-solid fa-house"></i> Dashboard</a>
 <a href="#" onclick="show('catalog')"><i class="fa-solid fa-book"></i> Courses</a>
 <a href="#" onclick="show('certs')"><i class="fa-solid fa-certificate"></i> Certificates</a>
 <a href="#" onclick="show('tickets')"><i class="fa-solid fa-ticket"></i> Tickets</a>
 <a href="#" onclick="logout()" class="logout"><i class="fa-solid fa-right-from-bracket"></i> Logout</a>
</div><!-- MAIN --><div class="main"><!-- HEADER --><div class="top-header">
 <h1>Welcome, <span id="studentName">Student</span> üëã</h1>
 <div class="badge">Student ID: <span id="studentId"></span></div>
</div><!-- DASHBOARD --><div id="dashboard">
 <div class="card">
  <h2>üöÄ Build Your Food Business Career</h2>
  <p>Professional courses, real-world skills, recognised certificates.</p>
 </div> <div class="card">
  <h3>üìä My Courses</h3>
  <div id="myCourses"></div>
 </div>
</div><!-- CATALOG --><div id="catalog" class="hidden">
 <div class="card">
  <h2>üß© Available Courses</h2>
  <div class="grid" id="courseGrid"></div>
 </div>
</div><!-- COURSE PAGE --><div id="coursePage" class="hidden"></div><!-- CERTS --><div id="certs" class="hidden"><div class="card"><h3>üèÜ Certificates</h3><ul id="certList"></ul></div></div><!-- TICKETS --><div id="tickets" class="hidden"><div class="card"><h3>üéüÔ∏è Support Tickets</h3><p>Coming soon</p></div></div></div>
</div><!-- FIREBASE --><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script><script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script><script>
firebase.initializeApp({
 apiKey:"AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
 authDomain:"students-login-29409.firebaseapp.com",
 projectId:"students-login-29409"
});
const auth=firebase.auth();
const db=firebase.firestore();

const courses=[
 {name:"Food Business Basics",price:"$49",modules:["Introduction","Planning","Food Safety","Operations"],quiz:[{q:"Why is food safety important?",options:["Protects consumers","Optional"],correct:0}]},
 {name:"Dried Fruits Processing & Export",price:"$69",modules:["Drying Methods","Packaging","Export Compliance"],quiz:[{q:"Main reason for drying fruits?",options:["Preservation","Decoration"],correct:0}]}
];

let currentCourse=null,completedModules=[];

function show(id){['dashboard','catalog','coursePage','certs','tickets'].forEach(s=>document.getElementById(s).classList.add('hidden'));document.getElementById(id).classList.remove('hidden')}

function logout(){auth.signOut().then(()=>location.href='index.html')}

/* AUTH */
auth.onAuthStateChanged(async user=>{
 if(!user){location.href='index.html';return}
 studentId.innerText=user.uid.slice(0,8)
 const ref=db.collection('students').doc(user.uid)
 let snap=await ref.get()
 if(!snap.exists){await ref.set({username:user.email.split('@')[0],enrolledCourses:{},certificates:[]});snap=await ref.get()}
 const data=snap.data()
 studentName.innerText=data.username
 renderMyCourses(data.enrolledCourses)
 renderCatalog()
 renderCerts(data.certificates)
})

function renderMyCourses(enrolled){
 myCourses.innerHTML=''
 Object.keys(enrolled||{}).forEach(c=>{
  myCourses.innerHTML+=`<div class='card'><h4>${c}</h4><div class='progress'><span style='width:${enrolled[c].progress||0}%'></span></div><button onclick="openCourse('${c}')">Continue</button></div>`
 })
}

function renderCatalog(){
 courseGrid.innerHTML=''
 courses.forEach(c=>{
  courseGrid.innerHTML+=`<div class='card'><h3>${c.name}</h3>${c.modules.map(m=>`<div class='module'>${m}</div>`).join('')}<strong>${c.price}</strong><br><button onclick="pay('${c.name}')">Pay & Start</button></div>`
 })
}

async function pay(name){
 await db.collection('students').doc(auth.currentUser.uid).set({enrolledCourses:{[name]:{paid:true,progress:0,completedModules:[],quizPassed:false}}},{merge:true})
 openCourse(name)
}

async function openCourse(name){
 show('coursePage')
 const snap=await db.collection('students').doc(auth.currentUser.uid).get()
 const data=snap.data().enrolledCourses[name]
 currentCourse=courses.find(c=>c.name===name)
 completedModules=data.completedModules||[]
 coursePage.innerHTML=`<div class='card'><h2>${name}</h2>${currentCourse.modules.map(m=>`<div class='module ${completedModules.includes(m)?'completed':''}' onclick="completeModule('${m}')">${m}</div>`).join('')}<div class='progress'><span style='width:${data.progress}%'></span></div>${data.progress===100&&!data.quizPassed?renderQuiz():''}<button onclick="show('dashboard')">Back</button></div>`
}

async function completeModule(m){
 if(completedModules.includes(m))return
 completedModules.push(m)
 const progress=Math.round((completedModules.length/currentCourse.modules.length)*100)
 await db.collection('students').doc(auth.currentUser.uid).set({enrolledCourses:{[currentCourse.name]:{completedModules,progress}}},{merge:true})
 openCourse(currentCourse.name)
}

function renderQuiz(){
 return `<h3>Quiz</h3>${currentCourse.quiz.map((q,i)=>`<p>${q.q}</p>${q.options.map((o,j)=>`<label><input type='radio' name='q${i}' value='${j}'> ${o}</label><br>`).join('')}`).join('')}<button onclick='submitQuiz()'>Submit Quiz</button>`
}

async function submitQuiz(){
 let pass=true
 currentCourse.quiz.forEach((q,i)=>{
  const a=document.querySelector(`input[name=q${i}]:checked`)
  if(!a||+a.value!==q.correct)pass=false
 })
 if(!pass){alert('Quiz failed');return}
 await db.collection('students').doc(auth.currentUser.uid).set({enrolledCourses:{[currentCourse.name]:{quizPassed:true}},certificates:firebase.firestore.FieldValue.arrayUnion(currentCourse.name)},{merge:true})
 generateCertificate()
}

function generateCertificate(){
 const {jsPDF}=window.jspdf
 const doc=new jsPDF()
 doc.text('Certificate of Completion',105,40,null,null,'center')
 doc.text(currentCourse.name,105,65,null,null,'center')
 doc.text('Awarded to '+studentName.innerText,105,90,null,null,'center')
 doc.save('certificate.pdf')
}

function renderCerts(list){certList.innerHTML=(list||[]).map(c=>`<li>${c}</li>`).join('')}
</script></body>
</html>
