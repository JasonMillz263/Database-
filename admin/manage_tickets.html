<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Ticket Inbox</title>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #eef1f5;
      padding: 1rem;
    }

    h2 {
      text-align: center;
    }

    .ticket {
      background: white;
      padding: 1rem;
      margin-bottom: 1rem;
      border-radius: 8px;
    }

    select {
      width: 100%;
      padding: 0.5rem;
      margin-top: 0.5rem;
    }

    img {
      max-width: 100%;
      margin-top: 0.5rem;
      border-radius: 6px;
    }
  </style>
</head>

<body>

<h2>Admin Ticket Inbox</h2>
<div id="tickets"></div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js";
  import { getFirestore, collection, onSnapshot, doc, updateDoc, serverTimestamp } 
    from "https://www.gstatic.com/firebasejs/10.12.4/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
    authDomain: "students-login-29409.firebaseapp.com",
    projectId: "students-login-29409",
    storageBucket: "students-login-29409.firebasestorage.app",
    messagingSenderId: "634331456872",
    appId: "1:634331456872:web:6dae360c5e28d8356562dd",
    measurementId: "G-96XXYG1VR2"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const ticketsEl = document.getElementById("tickets");

  onSnapshot(collection(db, "tickets"), snap => {
    ticketsEl.innerHTML = "";
    snap.forEach(d => {
      const t = d.data();
      ticketsEl.innerHTML += `
        <div class="ticket">
          <strong>${t.userEmail}</strong>
          <p>${t.description}</p>
          <img src="${t.imageBase64}">
          <select onchange="updateStatus('${d.id}', this.value)">
            <option value="open" ${t.status==="open"?"selected":""}>Open</option>
            <option value="in_review" ${t.status==="in_review"?"selected":""}>In Review</option>
            <option value="closed" ${t.status==="closed"?"selected":""}>Closed</option>
          </select>
        </div>
      `;
    });
  });

  window.updateStatus = async (id, status) => {
    await updateDoc(doc(db, "tickets", id), {
      status,
      updatedAt: serverTimestamp()
    });
  };
</script>

</body>
</html>
