<!DOCTYPE html>
<html>
<head>
<title>Admin Course Publisher</title>

<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.min.js"></script>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, doc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain: "students-login-29409.firebaseapp.com",
  projectId: "students-login-29409",
  storageBucket: "students-login-29409.firebasestorage.app",
  messagingSenderId: "634331456872",
  appId: "1:634331456872:web:6dae360c5e28d8356562dd"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let courseId = null;
const quill = new Quill('#editor', { theme: 'snow' });

window.createCourse = async () => {
  const ref = await addDoc(collection(db,"courses"),{
    title: title.value,
    description: desc.value,
    published: true,
    createdAt: new Date()
  });
  courseId = ref.id;
  alert("Course Created");
};

window.addLesson = async () => {
  if(!courseId) return alert("Create course first");
  await addDoc(collection(db,"courses",courseId,"modules","module1","lessons"),{
    title: lessonTitle.value,
    contentHTML: quill.root.innerHTML,
    videoURL: videoURL.value,
    ttsEnabled: true
  });
  alert("Lesson Added");
};

window.addQuiz = async () => {
  await addDoc(collection(db,"courses",courseId,"quizzes"),{
    question: q.value,
    options:[a.value,b.value,c.value,d.value],
    correctIndex: correct.value
  });
  alert("Quiz Added");
};
</script>
</head>

<body>
<h2>Create Course</h2>
<input id="title" placeholder="Course Title">
<textarea id="desc" placeholder="Description"></textarea>
<button onclick="createCourse()">Create Course</button>

<h3>Add Lesson</h3>
<input id="lessonTitle">
<input id="videoURL" placeholder="Video URL">
<div id="editor"></div>
<button onclick="addLesson()">Publish Lesson</button>

<h3>Add Quiz</h3>
<input id="q" placeholder="Question">
<input id="a"><input id="b"><input id="c"><input id="d">
<input id="correct" placeholder="Correct index (0-3)">
<button onclick="addQuiz()">Add Quiz</button>
</body>
</html>
