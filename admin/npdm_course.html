<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin â€“ New Product Development and Management Course</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>

<style>
*{box-sizing:border-box}
html,body{overflow-x:hidden}
body{
  font-family:Segoe UI,system-ui;
  background:#f1f5f9;
  padding:10px;
  margin:0;
}
body.dark{background:#0f172a;color:#f8fafc}

/* HEADER */
header{
background:#4f46e5;
color:#fff;
padding:16px;
border-radius:16px;
display:flex;
flex-direction:column;
gap:10px;
}
.header-top{
display:flex;
justify-content:space-between;
align-items:center;
}
.header-left{
display:flex;
flex-direction:column;
gap:2px;
}
.header-left .title{
display:flex;
gap:10px;
align-items:center;
font-size:18px;
font-weight:700;
}
.header-left .subtitle{
font-size:12px;
opacity:.9;
letter-spacing:1px;
}
.header-right{
display:flex;
gap:10px;
align-items:center;
}
.header-chip{
background:rgba(255,255,255,.15);
padding:6px 12px;
border-radius:20px;
font-size:12px;
white-space:nowrap;
}
.theme-btn{
background:rgba(255,255,255,.2);
border:none;
border-radius:50%;
width:36px;
height:36px;
font-size:16px;
cursor:pointer;
color:#fff;
}

/* CARDS */
.card{
background:#fff;
padding:14px;
border-radius:14px;
margin-top:12px;
animation:fadeIn .25s ease;
overflow:hidden;
}
body.dark .card{background:#1e293b}

@keyframes fadeIn{
from{opacity:0;transform:translateY(6px)}
to{opacity:1;transform:none}
}

/* INPUTS */
input,button{
width:100%;
padding:12px;
margin:6px 0;
font-size:15px;
}
input{
border:1px solid #e5e7eb;
border-radius:10px;
}
button{
border:none;
border-radius:12px;
font-weight:600;
cursor:pointer;
transition:transform .15s ease;
}
button:active{transform:scale(.96)}

/* BUTTON COLORS */
.publish{background:#16a34a;color:#fff}
.draft{background:#f59e0b;color:#000}
.delete{background:#dc2626;color:#fff}
.view{background:#0ea5e9;color:#fff}

/* QUIZ */
.quiz{
background:#eef2ff;
padding:10px;
border-radius:10px;
margin:8px 0;
display:flex;
flex-direction:column;
gap:6px;
}
body.dark .quiz{background:#334155}

/* TABS */
.tabs{
display:flex;
gap:8px;
margin-top:14px;
}
.tabs button{flex:1;background:#e5e7eb}
.tabs button.active{background:#4f46e5;color:#fff}

/* QUILL */
#quill{border-radius:12px;overflow:hidden}
.ql-editor{
font-size:15px;
line-height:1.6;
padding:12px;
}
.ql-editor img,
.viewer img{
max-width:100%;
height:auto;
display:block;
margin:12px auto;
border-radius:10px;
}

/* TOAST */
#toast{
position:fixed;
bottom:20px;
left:50%;
transform:translateX(-50%);
background:#111827;
color:#fff;
padding:12px 16px;
border-radius:14px;
display:flex;
gap:10px;
align-items:center;
z-index:9999;
animation:fadeIn .2s ease;
}
#toast.hidden{display:none}

.hidden{display:none}

/* MOBILE */
@media(min-width:768px){
body{max-width:720px;margin:auto}
}
</style>
</head>

<body>

<header>
  <div class="header-top">
    <div class="header-left">
      <div class="title">
        <i class="fa fa-user-shield"></i>
        Admin Panel
      </div>
      <div class="subtitle" id="courseTitle"></div>
    </div>
    <div class="header-right">
      <div id="authStatus" class="header-chip">Checkingâ€¦</div>
      <button class="theme-btn">ðŸŒ“</button>
    </div>
  </div>
</header>

<div id="toast" class="hidden">
  <i class="fa fa-spinner fa-spin"></i>
  <span id="toastText"></span>
</div>

<div class="card hidden" id="addModuleCard">
  <button class="publish">âž• Add New Module</button>
</div>

<div class="card hidden" id="editor">
  <h3>Module Editor</h3>
  <input id="title" placeholder="Module title">
  <input id="videoUrl" placeholder="Video URL">
  <div id="quill" style="height:220px"></div>

  <h4>Quizzes</h4>
  <input id="q" placeholder="Question">
  <input id="o1" placeholder="Option 1">
  <input id="o2" placeholder="Option 2">
  <input id="o3" placeholder="Option 3">
  <input id="o4" placeholder="Option 4">
  <input id="a" placeholder="Correct answer">

  <button>Add / Update Quiz</button>
  <div id="quizList"></div>

  <button class="draft">Save Draft</button>
  <button class="publish">Publish</button>
</div>

<div class="tabs">
  <button class="active">Published</button>
  <button>Drafts</button>
  <button>Recycle Bin</button>
</div>

<div class="card" id="publishedTab"></div>
<div class="card hidden" id="draftTab"></div>
<div class="card hidden" id="binTab"></div>
<div class="card hidden viewer" id="viewer"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
import {
  getFirestore, collection, doc, addDoc, getDocs,
  updateDoc, getDoc, serverTimestamp,
  query, orderBy
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";
import {
  getAuth, signInWithEmailAndPassword, onAuthStateChanged
} from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";

/* COURSE CONFIG */
const COURSE_ID = "new-product-development-and-management";
const COURSE_NAME = "New Product Development and Management Course";
document.getElementById("courseTitle").innerText = COURSE_NAME;

/* FIREBASE */
const app = initializeApp({
  apiKey:"AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain:"students-login-29409.firebaseapp.com",
  projectId:"students-login-29409"
});

const db = getFirestore(app);
const auth = getAuth(app);
signInWithEmailAndPassword(auth,"ADMIN_EMAIL","ADMIN_PASSWORD");

/* AUTH */
onAuthStateChanged(auth, async user=>{
  if(!user){authStatus.innerText="Not logged in";return;}
  const admin = await getDoc(doc(db,"admins",user.uid));
  if(!admin.exists()){authStatus.innerText="Not admin";return;}
  authStatus.innerText="Admin Verified";
  addModuleCard.classList.remove("hidden");
  loadModules();
});

/* QUILL */
const quill = new Quill("#quill",{
  theme:"snow",
  modules:{
    toolbar:{
      container:[
        [{header:[1,2,3,false]}],
        ["bold","italic","underline"],
        [{list:"ordered"},{list:"bullet"}],
        ["link","image"],["clean"]
      ],
      handlers:{ image:imageHandler }
    }
  }
});

function imageHandler(){
  const input=document.createElement("input");
  input.type="file";
  input.accept="image/*";
  input.click();
  input.onchange=()=>{
    const file=input.files[0];
    if(!file)return;
    toastText.innerText="Uploading image...";
    toast.classList.remove("hidden");
    const reader=new FileReader();
    reader.onload=()=>{
      quill.insertEmbed(quill.getLength(),"image",reader.result);
      toastText.innerText="Image uploaded";
      setTimeout(()=>toast.classList.add("hidden"),1200);
    };
    reader.readAsDataURL(file);
  };
}

/* MODULE LOGIC */
let quizzes=[], editingId=null;

function openEditor(){
  editor.classList.remove("hidden");
  title.value="";
  videoUrl.value="";
  quill.root.innerHTML="";
  quizzes=[];
  quizList.innerHTML="";
  editingId=null;
}

function addQuiz(){
  quizzes.push({
    q:q.value,o1:o1.value,o2:o2.value,o3:o3.value,o4:o4.value,a:a.value
  });
  quizList.innerHTML += `<div class="quiz">${q.value}</div>`;
  q.value=o1.value=o2.value=o3.value=o4.value=a.value="";
}

async function saveModule(status){
  const data={
    title:title.value.trim(),
    videoUrl:videoUrl.value.trim(),
    content:quill.root.innerHTML,
    quizzes,
    status,
    courseId:COURSE_ID,
    updatedAt:serverTimestamp()
  };

  const ref=collection(db,"courses",COURSE_ID,"modules");

  if(editingId){
    await updateDoc(doc(ref,editingId),data);
  }else{
    data.createdAt=serverTimestamp();
    await addDoc(ref,data);
  }

  editor.classList.add("hidden");
  loadModules();
}

async function loadModules(){
  publishedTab.innerHTML="";
  draftTab.innerHTML="";
  binTab.innerHTML="";

  const ref=collection(db,"courses",COURSE_ID,"modules");
  const snap=await getDocs(query(ref,orderBy("createdAt","desc")));

  snap.forEach(d=>{
    const m=d.data();
    const div=document.createElement("div");
    div.className="quiz";
    div.innerHTML=`<strong>${m.title}</strong><br>Status: ${m.status}`;
    if(m.status==="published")publishedTab.appendChild(div);
    else if(m.status==="draft")draftTab.appendChild(div);
    else binTab.appendChild(div);
  });
}

function showTab(id,btn){
  document.querySelectorAll(".card").forEach(c=>c.classList.add("hidden"));
  document.getElementById(id).classList.remove("hidden");
  document.querySelectorAll(".tabs button").forEach(b=>b.classList.remove("active"));
  btn.classList.add("active");
}

function toggleTheme(){
  document.body.classList.toggle("dark");
}

/* EXPOSE FUNCTIONS FOR BUTTONS */
window.openEditor = openEditor;
window.addQuiz = addQuiz;
window.saveModule = saveModule;
window.showTab = showTab;
window.toggleTheme = toggleTheme;

/* ATTACH BUTTON EVENT LISTENERS */
document.querySelector("#addModuleCard button").onclick = openEditor;
document.querySelector("#editor button.draft").onclick = () => saveModule('draft');
document.querySelector("#editor button.publish").onclick = () => saveModule('published');
document.querySelector("#editor button:nth-of-type(1)").onclick = addQuiz; // Add/Update Quiz
document.querySelector(".theme-btn").onclick = toggleTheme;
document.querySelectorAll(".tabs button").forEach((btn,i)=>{
  const tabs = ["publishedTab","draftTab","binTab"];
  btn.onclick = () => showTab(tabs[i],btn);
});
</script>

</body>
</html>
