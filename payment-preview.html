<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment | Food Business Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --primary:#2563eb;
  --secondary:#7c3aed;
  --accent:#f59e0b;
  --bg:linear-gradient(135deg,#e0e7ff,#fdfcff);
  --card:#ffffff;
  --text:#1f2937;
}

*{
  box-sizing:border-box;
  font-family:'Poppins',sans-serif;
}

body{
  margin:0;
  min-height:100vh;
  background:var(--bg);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:24px;
}

/* ================= CARD ================= */
.card{
  width:100%;
  max-width:580px;
  background:var(--card);
  border-radius:32px;
  padding:36px;
  box-shadow:0 40px 90px rgba(0,0,0,.18);
  animation:slideUp .6s ease;
}

@keyframes slideUp{
  from{opacity:0;transform:translateY(40px)}
  to{opacity:1;transform:none}
}

h2{
  text-align:center;
  margin-bottom:26px;
  font-size:26px;
}

.section{margin-bottom:26px}

.box{
  background:#f8fafc;
  padding:18px;
  border-radius:18px;
}

.row{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:10px;
}

.methods label{
  display:flex;
  align-items:center;
  gap:14px;
  padding:16px;
  border-radius:18px;
  background:#f1f5f9;
  cursor:pointer;
  margin-bottom:12px;
  transition:.3s;
}

.methods label:hover{
  background:#eef2ff;
  transform:scale(1.01);
}

.methods input{accent-color:var(--primary)}

.btn{
  width:100%;
  padding:18px;
  border:none;
  border-radius:20px;
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
  transition:.3s;
}

.btn:hover{transform:translateY(-2px)}
.btn:disabled{opacity:.6;cursor:not-allowed}

.loader{
  text-align:center;
  margin-top:18px;
  display:none;
}

/* ================= MODAL ================= */
.modal{
  position:fixed;
  inset:0;
  background:rgba(0,0,0,.6);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:999;
}

.invoice{
  background:#fff;
  width:100%;
  max-width:780px;
  padding:42px;
  border-radius:30px;
  box-shadow:0 40px 90px rgba(0,0,0,.25);
  animation:fadeIn .5s ease;
}

@keyframes fadeIn{
  from{opacity:0;transform:scale(.95)}
  to{opacity:1;transform:none}
}

.badge{
  padding:8px 18px;
  border-radius:999px;
  background:#fef3c7;
  color:#92400e;
  font-weight:600;
  font-size:13px;
}

.grid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
}

.total{
  margin-top:24px;
  display:flex;
  justify-content:space-between;
  font-size:20px;
  font-weight:700;
}

.actions{
  margin-top:32px;
  display:flex;
  gap:16px;
}

.actions button{
  flex:1;
  padding:16px;
  border:none;
  border-radius:18px;
  font-weight:600;
  cursor:pointer;
}

.print{background:#e5e7eb}
.dashboard{
  background:linear-gradient(135deg,var(--primary),var(--secondary));
  color:#fff;
}

@media print{
  body *{visibility:hidden}
  .invoice,.invoice *{visibility:visible}
  .invoice{position:absolute;left:0;top:0;width:100%}
}
</style>
</head>

<body>

<!-- ================= PAYMENT CARD ================= -->
<div class="card">
  <h2>Payment Preview</h2>

  <div class="section">
    <h4>Student Details</h4>
    <div class="box">
      <div class="row"><span>Name</span><strong id="sName"></strong></div>
      <div class="row"><span>Email</span><strong id="sEmail"></strong></div>
      <div class="row"><span>Phone</span><strong id="sPhone"></strong></div>
    </div>
  </div>

  <div class="section">
    <h4>Course</h4>
    <div class="box">
      <div class="row"><span>Course</span><strong id="sCourse"></strong></div>
      <div class="row"><span>Amount</span><strong>$<span id="sPrice"></span></strong></div>
    </div>
  </div>

  <div class="section">
    <h4>Select Payment Method</h4>
    <div class="methods">
      <label><input type="radio" name="method" value="Ecocash"> üì± Ecocash</label>
      <label><input type="radio" name="method" value="OneMoney"> üì± One Money</label>
      <label><input type="radio" name="method" value="Bank"> üè¶ Bank Transfer</label>
    </div>
  </div>

  <button class="btn" id="payBtn" disabled>Proceed with Payment</button>
  <div class="loader" id="loader">Creating invoice‚Ä¶</div>
</div>

<!-- ================= INVOICE MODAL ================= -->
<div class="modal" id="invoiceModal">
  <div class="invoice">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h2>Food Business Academy</h2>
      <span class="badge">Pending Payment</span>
    </div>

    <div class="section">
      <h4>Student Details</h4>
      <div class="grid">
        <div class="row"><span>Name</span><strong id="iName"></strong></div>
        <div class="row"><span>Email</span><strong id="iEmail"></strong></div>
        <div class="row"><span>Phone</span><strong id="iPhone"></strong></div>
        <div class="row"><span>Invoice No</span><strong id="iNumber"></strong></div>
      </div>
    </div>

    <div class="section">
      <h4>Course & Payment</h4>
      <div class="grid">
        <div class="row"><span>Course</span><strong id="iCourse"></strong></div>
        <div class="row"><span>Method</span><strong id="iMethod"></strong></div>
        <div class="row"><span>Date</span><strong id="iDate"></strong></div>
      </div>

      <div class="total">
        <span>Total</span>
        <span>$<span id="iAmount"></span></span>
      </div>
    </div>

    <div class="actions">
      <button class="print" onclick="window.print()">üñ® Print / Download</button>
      <button class="dashboard" onclick="location.href='dashboard.html'">Dashboard</button>
    </div>
  </div>
</div>

<!-- ================= FIREBASE + LOGIC ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

/* üî• YOUR FIREBASE CONFIG */
const firebaseConfig = {
  apiKey: "AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain: "students-login-29409.firebaseapp.com",
  projectId: "students-login-29409",
  storageBucket: "students-login-29409.firebasestorage.app",
  messagingSenderId: "634331456872",
  appId: "1:634331456872:web:6dae360c5e28d8356562dd",
  measurementId: "G-96XXYG1VR2"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* STUDENT DATA */
const student = {
  name: localStorage.getItem("studentName") || "John Doe",
  email: localStorage.getItem("studentEmail") || "student@email.com",
  phone: localStorage.getItem("studentPhone") || "0770000000",
  course: localStorage.getItem("courseName") || "Food Business Course",
  price: localStorage.getItem("coursePrice") || "100"
};

sName.textContent = student.name;
sEmail.textContent = student.email;
sPhone.textContent = student.phone;
sCourse.textContent = student.course;
sPrice.textContent = student.price;

/* ENABLE BUTTON */
document.querySelectorAll('input[name="method"]').forEach(r=>{
  r.addEventListener("change",()=> payBtn.disabled=false);
});

/* CREATE INVOICE */
payBtn.onclick = async ()=>{
  const method = document.querySelector('input[name="method"]:checked')?.value;
  if(!method) return;

  loader.style.display="block";
  payBtn.disabled=true;

  const ref = await addDoc(collection(db,"invoices"),{
    studentName: student.name,
    email: student.email,
    phone: student.phone,
    course: student.course,
    amount: student.price,
    paymentMethod: method,
    status: "pending",
    createdAt: serverTimestamp()
  });

  iName.textContent = student.name;
  iEmail.textContent = student.email;
  iPhone.textContent = student.phone;
  iCourse.textContent = student.course;
  iMethod.textContent = method;
  iAmount.textContent = student.price;
  iNumber.textContent = "FBA-" + ref.id.slice(0,8).toUpperCase();
  iDate.textContent = new Date().toLocaleDateString();

  invoiceModal.style.display="flex";
};
</script>

</body>
</html>
