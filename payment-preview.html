<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment | Food Business Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

<style>
/* ===== YOUR ORIGINAL DESIGN (UNCHANGED) ===== */
:root{
  --blue:#2563eb;
  --purple:#6d28d9;
  --card:#ffffff;
  --text:#1f2937;
  --accent:#f59e0b;
}

*{box-sizing:border-box;font-family:'Poppins',sans-serif}

body{
  margin:0;
  min-height:100vh;
  background:linear-gradient(135deg,#e0e7ff,#ffffff);
  display:flex;
  align-items:center;
  justify-content:center;
  padding:20px;
}

.card{
  max-width:560px;
  width:100%;
  background:#fff;
  padding:34px;
  border-radius:30px;
  box-shadow:0 30px 70px rgba(0,0,0,.18);
}

.section{margin-bottom:24px}

.box{
  background:#f8fafc;
  padding:18px;
  border-radius:18px;
}

.row{
  display:flex;
  justify-content:space-between;
  font-size:14px;
  margin-bottom:10px;
}

.methods label{
  display:flex;
  gap:12px;
  padding:14px;
  background:#f1f5f9;
  border-radius:16px;
  cursor:pointer;
  margin-bottom:10px;
}

.btn{
  width:100%;
  padding:16px;
  border:none;
  border-radius:18px;
  background:linear-gradient(135deg,var(--blue),var(--purple));
  color:#fff;
  font-size:16px;
  font-weight:600;
  cursor:pointer;
}

.btn:disabled{
  opacity:.6;
  cursor:not-allowed;
}

.loader{
  display:none;
  text-align:center;
  margin-top:16px;
  font-size:14px;
}
</style>
</head>

<body>

<div class="card">

  <h2 style="text-align:center">Payment Preview</h2>

  <div class="section">
    <h4>Student Details</h4>
    <div class="box">
      <div class="row"><span>Name</span><strong id="name"></strong></div>
      <div class="row"><span>Email</span><strong id="email"></strong></div>
      <div class="row"><span>Phone</span><strong id="phone"></strong></div>
    </div>
  </div>

  <div class="section">
    <h4>Course</h4>
    <div class="box">
      <div class="row"><span>Course</span><strong id="course"></strong></div>
      <div class="row"><span>Amount</span><strong>$<span id="price"></span></strong></div>
    </div>
  </div>

  <div class="section">
    <h4>Select Payment Method</h4>
    <div class="methods">
      <label><input type="radio" name="method" value="Ecocash"> Ecocash</label>
      <label><input type="radio" name="method" value="OneMoney"> One Money</label>
      <label><input type="radio" name="method" value="Bank"> Bank Transfer</label>
    </div>
  </div>

  <button class="btn" id="payBtn" disabled>Proceed with Payment</button>

  <div class="loader" id="loader">Creating invoice…</div>

</div>

<!-- ================= FIXED SCRIPT ================= -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT_ID"
};

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

/* LOAD DATA */
const student = {
  name: localStorage.getItem("studentName"),
  email: localStorage.getItem("studentEmail"),
  phone: localStorage.getItem("studentPhone"),
  course: localStorage.getItem("courseName"),
  price: Number(localStorage.getItem("coursePrice"))
};

document.getElementById("name").textContent = student.name;
document.getElementById("email").textContent = student.email;
document.getElementById("phone").textContent = student.phone;
document.getElementById("course").textContent = student.course;
document.getElementById("price").textContent = student.price;

/* ENABLE BUTTON */
const payBtn = document.getElementById("payBtn");
document.querySelectorAll('input[name="method"]').forEach(r=>{
  r.addEventListener("change",()=> payBtn.disabled = false);
});

/* ✅ WORKING BUTTON LOGIC */
payBtn.addEventListener("click", async ()=>{
  const method = document.querySelector('input[name="method"]:checked')?.value;
  if(!method) return;

  payBtn.disabled = true;
  document.getElementById("loader").style.display = "block";

  const docRef = await addDoc(collection(db,"invoices"),{
    studentName: student.name,
    email: student.email,
    phone: student.phone,
    course: student.course,
    amount: student.price,
    paymentMethod: method,
    status: "pending",
    createdAt: serverTimestamp()
  });

  localStorage.setItem("invoiceId", docRef.id);

  window.location.href = "invoice.html?id=" + docRef.id;
});
</script>

</body>
</html>
