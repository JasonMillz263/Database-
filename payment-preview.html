<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Payment Preview - Food Business Academy</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{
  font-family:'Poppins',sans-serif;
  background:#f4f6fb;
  padding:20px;
}
.container{
  max-width:480px;
  margin:auto;
  background:#fff;
  padding:20px;
  border-radius:16px;
  box-shadow:0 8px 25px rgba(0,0,0,0.08);
}
h2{text-align:center;margin-bottom:15px;}
p{margin:6px 0;font-size:14px;}

select,button{
  width:100%;
  padding:12px;
  margin-top:12px;
  border-radius:10px;
  border:1px solid #ddd;
}
button{
  background:#2563eb;
  color:#fff;
  font-weight:600;
  border:none;
  cursor:pointer;
}
button:hover{background:#6d28d9}

#invoicePopup{
  display:none;
  position:fixed;
  inset:0;
  background:rgba(0,0,0,0.6);
  z-index:9999;
}
#invoiceBox{
  background:#fff;
  max-width:420px;
  margin:10% auto;
  padding:20px;
  border-radius:16px;
}
.closeBtn{background:#22c55e;}
.pdfBtn{background:#0ea5e9;}
</style>
</head>

<body>

<div class="container">
  <h2>Payment Preview</h2>

  <p><strong>Name:</strong> <span id="name"></span></p>
  <p><strong>Email:</strong> <span id="email"></span></p>
  <p><strong>Phone:</strong> <span id="phone"></span></p>
  <p><strong>Course:</strong> <span id="course"></span></p>
  <p><strong>Amount:</strong> $<span id="price"></span></p>

  <select id="method">
    <option value="Ecocash">Ecocash</option>
    <option value="Bank Transfer">Bank Transfer</option>
    <option value="One Money">One Money</option>
  </select>

  <button type="button" onclick="proceedPayment()">Proceed to Payment</button>
</div>

<!-- INVOICE POPUP -->
<div id="invoicePopup">
  <div id="invoiceBox">
    <h3>Payment Invoice</h3>
    <p><strong>Invoice No:</strong> <span id="invoiceNo"></span></p>

    <p id="invoiceDetails"></p>

    <p><strong>Payment Instructions</strong></p>
    <p>
      üè¶ Bank: CBZ / FBC<br>
      üí∞ Ecocash: 077 XXX XXXX<br>
      üì± One Money: 071 XXX XXXX<br>
      üìå Reference: Invoice Number
    </p>

    <button class="pdfBtn" onclick="downloadPDF()">Download Invoice PDF</button>
    <button class="closeBtn" onclick="goBackToCourses()">Back to Courses</button>
  </div>
</div>

<script>
const name  = localStorage.getItem("studentName") || "";
const email = localStorage.getItem("studentEmail") || "";
const phone = localStorage.getItem("studentPhone") || "";

const course = localStorage.getItem("courseName") || "Selected Course";
const price  = localStorage.getItem("coursePrice") || "0";

const invoiceNumber = "FBA-" + Date.now();

document.getElementById("name").textContent = name;
document.getElementById("email").textContent = email;
document.getElementById("phone").textContent = phone;
document.getElementById("course").textContent = course;
document.getElementById("price").textContent = price;
document.getElementById("invoiceNo").textContent = invoiceNumber;

async function proceedPayment(){
  const method = document.getElementById("method").value;

  /* SAVE PENDING COURSE */
  const pendingCourses = JSON.parse(localStorage.getItem("pendingCourses")) || [];
  if(!pendingCourses.includes(course)){
    pendingCourses.push(course);
  }
  localStorage.setItem("pendingCourses", JSON.stringify(pendingCourses));

  /* SAVE PAYMENT RECORD */
  const payments = JSON.parse(localStorage.getItem("payments")) || [];
  payments.push({
    invoiceNumber,
    name,
    email,
    phone,
    course,
    price,
    method,
    status: "pending",
    date: new Date().toLocaleString()
  });
  localStorage.setItem("payments", JSON.stringify(payments));

  document.getElementById("invoiceDetails").innerHTML = `
    <strong>Name:</strong> ${name}<br>
    <strong>Email:</strong> ${email}<br>
    <strong>Course:</strong> ${course}<br>
    <strong>Amount:</strong> $${price}<br>
    <strong>Method:</strong> ${method}
  `;

  document.getElementById("invoicePopup").style.display = "block";
}

function downloadPDF(){
  const { jsPDF } = window.jspdf;
  const doc = new jsPDF();

  doc.setFontSize(16);
  doc.text("Food Business Academy", 20, 20);
  doc.setFontSize(12);
  doc.text(`Invoice No: ${invoiceNumber}`, 20, 35);
  doc.text(`Name: ${name}`, 20, 45);
  doc.text(`Email: ${email}`, 20, 55);
  doc.text(`Course: ${course}`, 20, 65);
  doc.text(`Amount: $${price}`, 20, 75);
  doc.text("Status: Pending Payment", 20, 90);

  doc.save(`${invoiceNumber}.pdf`);
}

function goBackToCourses(){
  window.location.href = "courses.html";
}
</script>

</body>
</html>
