<h2>Food Business Course Progress</h2>

<div id="student-info" style="margin-bottom:20px;"></div>

<div id="course-modules" style="max-width:600px;margin:auto;">

  <ul id="modules-list" style="list-style:none;padding:0;"></ul>

</div>

<p style="text-align:center;margin-top:20px;">

  Overall Progress: <span id="overall-progress">0</span>%

</p>

<button onclick="logout()" style="padding:10px;background:#FF4136;color:white;border:none;display:block;margin:20px auto;">

  Logout

</button>

<script>

// Modules for Food Business Course

const modules = [

  "Introduction to Food Business",

  "Business Planning",

  "Food Safety & Hygiene",

  "Marketing Your Food Business",

  "Finance & Budgeting",

  "Scaling Your Food Business"

];

// Reference to Firestore

const ref = auth.currentUser ? db.collection("Students Login").doc(auth.currentUser.uid) : null;

// Initialize page

auth.onAuthStateChanged(async (user) => {

    if (!user) {

        window.location.href = "/p/login.html";

        return;

    }

    const studentRef = db.collection("Students Login").doc(user.uid);

    let doc = await studentRef.get();

    if (!doc.exists) {

        // If document doesnâ€™t exist, create initial progress

        await studentRef.set({

            username: "Student",

            modulesCompleted: [],

            progress: 0,

            createdAt: new Date()

        });

        doc = await studentRef.get();

    }

    const data = doc.data();

    document.getElementById("student-info").innerHTML = `<strong>Welcome, ${data.username}</strong>`;

    renderModules(data.modulesCompleted || []);

});

// Render modules list

function renderModules(completedModules) {

    const list = document.getElementById("modules-list");

    list.innerHTML = "";

    modules.forEach((module, index) => {

        const li = document.createElement("li");

        li.style.marginBottom = "10px";

        li.style.padding = "10px";

        li.style.border = "1px solid #ccc";

        li.style.borderRadius = "5px";

        li.style.background = completedModules.includes(module) ? "#8A2BE2" : "#f4f4f4";

        li.style.color = completedModules.includes(module) ? "white" : "black";

        li.style.cursor = "pointer";

        li.innerText = module;

        li.onclick = async () => {

            if (!completedModules.includes(module)) {

                completedModules.push(module);

                await db.collection("Students Login").doc(auth.currentUser.uid).update({

                    modulesCompleted: completedModules,

                    progress: Math.round((completedModules.length / modules.length) * 100)

                });

                document.getElementById("overall-progress").innerText = Math.round((completedModules.length / modules.length) * 100);

                renderModules(completedModules);

            }

        };

        list.appendChild(li);

    });

    // Update overall progress

    document.getElementById("overall-progress").innerText = Math.round((completedModules.length / modules.length) * 100);

}

// Logout function

function logout() {

    auth.signOut();

    window.location.href = "/p/login.html";

}

</script>
