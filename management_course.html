<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
<meta charset="UTF-8">
<title>Student Course</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
/* ================= THEME ================= */
:root{
  --bg:#f7f9fa;
  --panel:#ffffff;
  --text:#1c1d1f;
  --muted:#6a6f73;
  --border:#d1d7dc;
  --accent:#5624d0;
}

[data-theme="dark"]{
  --bg:#1c1d1f;
  --panel:#2d2f31;
  --text:#ffffff;
  --muted:#b4b4b4;
  --border:#3e4143;
  --accent:#a78bfa;
}

*{box-sizing:border-box}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Inter,Segoe UI,sans-serif;
}

/* ================= UDEMY HEADER ================= */
.udemy-header{
  background:var(--panel);
  border-bottom:1px solid var(--border);
  padding:14px 18px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  position:sticky;
  top:0;
  z-index:100;
}

.udemy-left{
  display:flex;
  align-items:center;
  gap:14px;
}

.udemy-logo{
  font-weight:800;
  font-size:20px;
  color:var(--accent);
}

.course-title{
  font-weight:600;
  font-size:15px;
}

.udemy-right{
  display:flex;
  align-items:center;
  gap:14px;
  font-size:14px;
}

/* ================= THEME TOGGLE ================= */
.theme-toggle{
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:999px;
  padding:6px 12px;
  cursor:pointer;
  font-weight:600;
}

/* ================= PROGRESS ================= */
.progress-wrap{
  padding:14px 18px;
}

.progress-bar{
  height:6px;
  background:#e5e7eb;
  border-radius:999px;
  overflow:hidden;
}

.progress-fill{
  height:100%;
  background:var(--accent);
  width:0%;
}

/* ================= MODULE LIST (UDEMY STYLE) ================= */
.modules{
  padding:0 18px;
}

.module-row{
  border-bottom:1px solid var(--border);
  padding:16px 0;
}

.module-header{
  display:flex;
  justify-content:space-between;
  cursor:pointer;
}

.module-title{
  font-weight:600;
}

.module-meta{
  font-size:14px;
  color:var(--muted);
}

.module-row.locked{
  opacity:.5;
  pointer-events:none;
}

.lesson-content{
  display:none;
  margin-top:14px;
  line-height:1.6;
}

.module-row.open .lesson-content{
  display:block;
}

/* ================= QUIZ ================= */
.quiz-box{
  margin-top:14px;
  padding:14px;
  border:1px solid var(--border);
  border-radius:8px;
  background:var(--panel);
}

button{
  width:100%;
  margin-top:8px;
  padding:12px;
  border:none;
  border-radius:8px;
  background:var(--accent);
  color:#fff;
  font-weight:600;
  cursor:pointer;
}

.listen-btn{
  background:#f7a81b;
  color:#000;
}

/* ================= CERTIFICATE ================= */
#certificateSection{
  display:none;
  padding:30px;
}

.certificate{
  width:794px;
  height:1123px;
  margin:auto;
  background:#fff;
  border:14px solid #f7931e;
  position:relative;
}
</style>
</head>


<body>

<div class="udemy-header">
  <div class="udemy-left">
    <div class="udemy-logo">FoodPreneur</div>
    <div class="course-title">Management Course</div>
  </div>

  <div class="udemy-right">
    <span id="studentEmail"></span>
    <button class="theme-toggle" onclick="toggleTheme()">ðŸŒ™</button>
  </div>
</div>

<div class="progress-wrap">
  <div class="progress-bar">
    <div class="progress-fill" id="progressFill"></div>
  </div>
  <p id="progressText">0% completed</p>
</div>

<div class="modules" id="modules"></div>

<!-- CERTIFICATE -->
<div id="certificateSection">
  <div class="certificate">
    <h2 style="text-align:center;margin-top:60px">Certificate of Completion</h2>
    <p style="text-align:center">Awarded to</p>
    <h1 style="text-align:center" id="certName">STUDENT NAME</h1>
    <p style="text-align:center">For completing</p>
    <h2 style="text-align:center">Management Course</h2>
    <p style="text-align:center;margin-top:40px">
      Date: <span id="certDate"></span>
    </p>
  </div>

  <button onclick="window.print()">Print / Save PDF</button>
</div>


<script>
/* ================= THEME ================= */
const root=document.documentElement;
const savedTheme=localStorage.getItem("theme");
if(savedTheme) root.setAttribute("data-theme",savedTheme);

function toggleTheme(){
  const next=root.getAttribute("data-theme")==="dark"?"light":"dark";
  root.setAttribute("data-theme",next);
  localStorage.setItem("theme",next);
}

/* ================= FIREBASE ================= */
firebase.initializeApp({
  apiKey:"AIzaSyC_lKWa4cM4cT337KkRw4sp7raQHl9aZWk",
  authDomain:"students-login-29409.firebaseapp.com",
  projectId:"students-login-29409"
});

const auth=firebase.auth();
const db=firebase.firestore();

const COURSE_ID="management_course";
const PASS_MARK=60;

/* ================= AUTH ================= */
auth.onAuthStateChanged(async user=>{
  if(!user) return alert("Login required");
  studentEmail.innerText=user.email;
  loadModules(user);
});

/* ================= LOAD MODULES ================= */
async function loadModules(user){
  modules.innerHTML="";
  const modsSnap=await db.collection("courses")
    .doc(COURSE_ID)
    .collection("modules")
    .where("status","==","published")
    .get();

  const progressSnap=await db.collection("students").doc(user.uid).get();
  const completed=progressSnap.data()?.enrolledCourses?.[COURSE_ID]?.completedModules||{};

  let done=0,prev=true,index=1;

  modsSnap.forEach(doc=>{
    const m=doc.data(),id=doc.id;
    const passed=completed[id]===true;
    if(passed) done++;
    const locked=index>1&&!prev;
    prev=passed;

    const row=document.createElement("div");
    row.className="module-row"+(locked?" locked":"");
    row.innerHTML=`
      <div class="module-header" onclick="this.parentElement.classList.toggle('open')">
        <div>
          <div class="module-title">Module ${index}: ${m.title}</div>
          <div class="module-meta">${passed?"Completed":locked?"Locked":"Start"}</div>
        </div>
      </div>

      <div class="lesson-content">
        ${m.content}
        <div class="quiz-box">
          ${passed?"âœ… Completed":
          `<button class="listen-btn" onclick="readAloud(this)">ðŸ”Š Listen</button>
           <button onclick="startQuiz('${id}',this)">Start Quiz</button>`}
        </div>
      </div>
    `;
    modules.appendChild(row);
    index++;
  });

  updateProgress(done,modsSnap.size);

  if(done===modsSnap.size && modsSnap.size>0){
    showCertificate(user);
  }
}

/* ================= TTS WITH ANDROID MEDIA ================= */
function readAloud(btn){
  const text=btn.closest(".lesson-content").innerText;
  speechSynthesis.cancel();

  const u=new SpeechSynthesisUtterance(text);
  navigator.mediaSession.metadata=new MediaMetadata({
    title:"Course Lesson",
    artist:"FoodPreneur Academy"
  });

  navigator.mediaSession.setActionHandler("play",()=>speechSynthesis.resume());
  navigator.mediaSession.setActionHandler("pause",()=>speechSynthesis.pause());
  navigator.mediaSession.setActionHandler("stop",()=>speechSynthesis.cancel());

  speechSynthesis.speak(u);
}

/* ================= CERTIFICATE ================= */
function showCertificate(user){
  modules.style.display="none";
  certificateSection.style.display="block";
  certName.innerText=user.email.split("@")[0].replace("."," ").toUpperCase();
  certDate.innerText=new Date().toLocaleDateString();
}

/* ================= PROGRESS ================= */
function updateProgress(done,total){
  const p=total?Math.round(done/total*100):0;
  progressFill.style.width=p+"%";
  progressText.innerText=p+"% completed";
}
</script>

</body>
</html>

